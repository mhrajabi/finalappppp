import streamlit as st
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
import pandas as pd

# اطلاعات مدل (این مقادیر به صورت دستی وارد شده‌اند، اما می‌توانید آن‌ها را از مدل خود بگیرید)
accuracy = 100
classification_report = {
    "Class 0": {"Precision": 1.00, "Recall": 1.00, "F1-Score": 1.00},
    "Class 1": {"Precision": 1.00, "Recall": 1.00, "F1-Score": 1.00},
    "Class 2": {"Precision": 1.00, "Recall": 1.00, "F1-Score": 1.00},
}
confusion_matrix = np.array([[134, 0, 0], [0, 144, 0], [0, 0, 123]])

# ویژگی‌های دیتاست و توضیحات مربوط به ایمنی
features_info = {
    "سرعت قطار (km/h)": "سرعت بالاتر قطار می‌تواند ریسک وقوع حادثه را افزایش دهد. سرعت بالا می‌تواند موجب کاهش زمان واکنش و کنترل قطار شود.",
    "شیب مسیر (درجه)": "شیب مسیر تأثیر زیادی در کنترل قطار دارد. شیب‌های زیاد می‌توانند کنترل قطار را دشوارتر کنند.",
    "وزن بار (تن)": "وزن بار زیاد می‌تواند بر سرعت توقف قطار تأثیر بگذارد و منجر به افزایش احتمال حادثه شود.",
    "زمان سفر (ساعت)": "زمان طولانی‌تر سفر می‌تواند منجر به خستگی راننده و کاهش تمرکز شود.",
    "سن قطار (سال)": "قطارهای قدیمی‌تر ممکن است سیستم‌های فنی ضعیف‌تری داشته باشند و احتمال خرابی در آن‌ها بیشتر است.",
    "تجربه راننده (سال)": "تجربه بیشتر راننده می‌تواند تأثیر مثبتی بر توانایی مدیریت شرایط اضطراری داشته باشد.",
    "وضعیت نگهداری خط": "خطوط ریل که به درستی نگهداری نمی‌شوند می‌توانند موجب تصادف و خرابی قطار شوند.",
    "شرایط آب و هوایی": "شرایط آب و هوایی مانند باران، برف یا مه می‌تواند دید راننده را کاهش دهد و به سرعت توقف قطار آسیب برساند.",
    "نوع قطار": "نوع قطار می‌تواند تأثیر زیادی در سرعت، قابلیت کنترل و ایمنی آن در برابر شرایط مختلف داشته باشد.",
    "وضعیت ترافیک ریلی": "ترافیک ریلی زیاد می‌تواند موجب تأخیر در تصمیم‌گیری و پیچیدگی‌های اضافی در مسیر شود.",
    "کیفیت سیگنال": "کیفیت سیگنال‌های ارتباطی نقش حیاتی در هماهنگی قطارها دارد. سیگنال ضعیف می‌تواند به اشتباهات در ارتباط و تصمیم‌گیری منجر شود.",
    "وضعیت سیستم ترمز": "سیستم ترمز سالم و کارا برای جلوگیری از تصادفات بسیار حیاتی است.",
    "میزان پیچ مسیر (درجه)": "پیچ‌های تیز در مسیر می‌توانند موجب واژگونی یا خرابی قطار شوند.",
    "فاصله بین ایستگاه‌ها (km)": "فاصله زیاد بین ایستگاه‌ها می‌تواند باعث افزایش سرعت قطار و در نتیجه خطر بیشتر در صورت وقوع حادثه شود."
}

# صفحه اصلی
st.title("مدل ارزیابی حوادث قطار")

# دقت مدل
st.header("دقت مدل")
st.write(f"مدل با دقت {accuracy}% پیش‌بینی کرده است.")

# گزارش طبقه‌بندی
st.header("گزارش طبقه‌بندی")
classification_df = pd.DataFrame(classification_report).T
st.write(classification_df)

# نمایش ماتریس اشتباهات
st.header("ماتریس اشتباهات")
fig, ax = plt.subplots(figsize=(5, 4))
sns.heatmap(confusion_matrix, annot=True, fmt='d', cmap='Blues', xticklabels=["0", "1", "2"], yticklabels=["0", "1", "2"], ax=ax)
st.pyplot(fig)

# توضیحات بیشتر در مورد ایمنی
st.header("توضیحات ایمنی")
for feature, description in features_info.items():
    st.subheader(feature)
    st.write(description)

# فرم پیش‌بینی نمونه‌ای
st.header("پیش‌بینی حادثه")
st.write("لطفاً ویژگی‌های قطار و مسیر را وارد کنید تا مدل پیش‌بینی کند که چه نوع حادثه‌ای ممکن است اتفاق بیفتد.")

# ورودی‌های کاربر برای پیش‌بینی
speed = st.number_input("سرعت قطار (km/h)", value=50)
slope = st.number_input("شیب مسیر (درجه)", value=5)
weight = st.number_input("وزن بار (تن)", value=100)
travel_time = st.number_input("زمان سفر (ساعت)", value=2)
train_age = st.number_input("سن قطار (سال)", value=10)
driver_experience = st.number_input("تجربه راننده (سال)", value=5)
track_condition = st.selectbox("وضعیت نگهداری خط", ["عالی", "متوسط", "ضعیف"])
weather_condition = st.selectbox("شرایط آب و هوایی", ["آفتابی", "بارانی", "برفی", "مه‌آلود"])
train_type = st.selectbox("نوع قطار", ["مسافری", "باربری", "تریلر"])
traffic_condition = st.selectbox("وضعیت ترافیک ریلی", ["کم", "متوسط", "زیاد"])
signal_quality = st.selectbox("کیفیت سیگنال", ["عالی", "متوسط", "ضعیف"])
brake_condition = st.selectbox("وضعیت سیستم ترمز", ["عالی", "متوسط", "ضعیف"])
curve_degree = st.number_input("میزان پیچ مسیر (درجه)", value=5)
station_distance = st.number_input("فاصله بین ایستگاه‌ها (km)", value=10)

# محاسبه پیش‌بینی مدل (برای نمونه به صورت ساده)
# در اینجا فقط یک مثال فرضی برای پیش‌بینی داریم
risk = 0
if speed > 60:
    risk += 1
if slope > 7:
    risk += 1
if weight > 150:
    risk += 1
if weather_condition in ["بارانی", "برفی", "مه‌آلود"]:
    risk += 1
if brake_condition == "ضعیف":
    risk += 1

prediction = "حادثه کم" if risk <= 1 else "حادثه زیاد"

# نمایش پیش‌بینی
if st.button("پیش‌بینی حادثه"):
    st.write(f"مدل پیش‌بینی می‌کند که احتمال وقوع حادثه: {prediction}")

# دکمه دانلود گزارش
st.header("دانلود گزارش")
st.write("برای دانلود گزارش کامل مدل به فرمت PDF/Excel، بر روی دکمه زیر کلیک کنید.")
# (در این مرحله برای دانلود واقعی می‌توانید از کتابخانه‌هایی مانند `reportlab` برای PDF استفاده کنید)
if st.button("دانلود گزارش"):
    st.write("گزارش آماده دانلود است.")
    # در اینجا می‌توانید گزارش را ذخیره کرده و لینک دانلود بدهید